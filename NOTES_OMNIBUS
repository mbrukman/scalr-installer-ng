# TODO -- Add the iptables, etc. stuff.
# TODO -- Set the PATH from supervisor to other things


Omnibus:

 + Inspiration from: https://github.com/opscode/omnibus-chef-server.
   View: https://github.com/opscode/omnibus-software


 + Use omnibus to install non-specific dependencies, like php, apache, nginx, etc., to /opt/scalr/embedded/...
 + Use omnibus to install chef-solo (as a gem, in the embedded location, too).

 + Use omnibus-ctl (https://github.com/opscode/omnibus-ctl) and its "reconfigure" command to launch Chef solo.
 + Use a regular cookbook to initialize (runtime).
 + Use a configuration file on the system (/etc/scalr-server/scalr-server.rb -- https://github.com/opscode/omnibus-chef-server) to configure the components, etc.
   View: https://github.com/opscode/omnibus-chef-server/blob/master/files/chef-server-cookbooks/chef-server/libraries/chef_server.rb


Config files considerations:

 + `solo.json` for the runlist.
 + `/etc/scalr-server/scalr-server.rb` for user configuration.
 + Exclusively *declare* attributes in the `scalr-server.rb` file. No auto-generated passwords there.
   -> Also include whether services are enabled or not.
 + Store auto-generated passwords in `/etc/scalr-server/scalr-server-secrets.json`.



IN THE CONFIGURATION FILE, YOU MUST SKIP *default[:scalr_server]*

Make sure that when we convert to omnibus, DNA.json includes stuff like rackspace_timezone that
still needs to run!


--- !!! ---
Must have a tag.



To install:
- omnibus (install ruby + ruby-dev and use bundle install --binstubs to install)
- berks (gem install berkshelf)
- build-essential
- pkg-config
- cmake
- automake
- libtool
- rsync
- git
- swig
- perl
- makedepend (xutils-dev in Debian)

berks MUST be patched as per this: https://github.com/berkshelf/berkshelf-api/issues/112#issuecomment-45726425
# TODO - Try to override LC_ALL


apt-get update
apt-get install -y curl build-essential pkg-config cmake automake libtool rsync git swig xutils-dev

yum install -y curl rpm-build fakeroot cmake automake libtool rsync git swig xz imake perl-ExtUtils-MakeMaker


curl -sSL https://rvm.io/mpapis.asc | gpg --import - && curl -sSL https://get.rvm.io | bash -s stable --ruby
source /usr/local/rvm/scripts/rvm
gem install bundler
gem install --version=1.3.3 retryable
gem install --version=4.1.1 ridley
gem install berkshelf
git clone https://github.com/Scalr/installer-ng.git
cd installer-ng
git checkout omnibus-package
bundle install --binstubs

echo 'base_dir "/mnt"' > ./omnibus.rb

# Patch berks!

# go.


